<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏ã‡πà‡∏≠‡∏°</title>
<style>
body {
  font-family: "TH SarabunPSK", sans-serif;
  font-size: 14px;
  margin: 40px;
  color: #000;
}
h3 {
  text-align: center;
  margin-bottom: 0;
}
p.right {
  text-align: right;
  margin-top: 5px;
}
table {
  border-collapse: collapse;
  width: 100%;
  margin-bottom: 15px;
}
th, td {
  border: 1px solid #000;
  padding: 5px 6px;
  vertical-align: top;
}
th {
  text-align: center;
  background: #f5f5f5;
}
input[type="text"] {
  width: 100%;
  border: none;
  border-bottom: 1px dotted #000;
  font-size: 14px;
  font-family: "TH SarabunPSK", sans-serif;
  outline: none;
  background: transparent;
}
input[type="checkbox"] {
  transform: scale(1.2);
  margin-right: 4px;
}
button,.btnM {
  display: block;
  margin: 20px auto;
  font-size: 14px;
  padding: 6px 12px;
  background: #c00;
  color: #fff;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}
button:hover, .btnM:hover { background: #900; }
.status { text-align: center; font-weight: bold; margin-top: 10px; color: green; }
</style>
<div>
    <a href="notchoose.html" class="btnM">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô</a>
</div>
</head>
<body>
<p class="right">
  ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÅ‡∏ô‡∏ö‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô<br>
  ‡∏ù‡πà‡∏≤‡∏¢‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏•‡∏∞‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°
</p>

<h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏á‡∏≤‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏ã‡πà‡∏≠‡∏°</h3><br><br>

<div style="margin-bottom:20px;">
  <label>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏á‡∏≤‡∏ô (Job Number): </label>
  <input type="text" id="jobNumberInput" placeholder="‡πÄ‡∏ä‡πà‡∏ô JOB001" required>
</div>

<table>
  <tr><th>‡πÅ‡∏ú‡∏ô‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡πÄ‡∏ß‡∏•‡∏≤</th></tr>
  <tr><td>‡∏≠‡∏≠‡∏Å‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏à‡∏≤‡∏Å Office</td><td><input type="text" id="startDateInput"></td><td><input type="text" id="time1"></td></tr>
  <tr><td>‡∏ï‡∏£‡∏ß‡∏à‡∏ã‡πà‡∏≠‡∏°</td><td><input type="text" id="date2"></td><td><input type="text" id="time2"></td></tr>
  <tr><td>‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏•‡∏±‡∏ö Office</td><td><input type="text" id="endDateInput"></td><td><input type="text" id="time4"></td></tr>
</table>

<table>
  <tr>
    <td>‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</td>
    <td><label><input type="checkbox" id="car_company"> ‡∏£‡∏ñ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</label></td>
    <td><label><input type="checkbox" id="car_sales"> ‡∏£‡∏ñ Sales</label></td>
    <td><label><input type="checkbox" id="bus"> ‡∏£‡∏ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ó‡∏≤‡∏á</label></td>
    <td><label><input type="checkbox" id="plane"> ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ö‡∏¥‡∏ô</label></td>
  </tr>
  <tr>
    <td>Sales ‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà:</td>
    <td><label><input type="checkbox" id="sales_no"> ‡πÑ‡∏°‡πà‡πÑ‡∏õ</label></td>
    <td><label><input type="checkbox" id="sales_yes"> ‡πÑ‡∏õ</label></td>
    <td><label><input type="checkbox" id="sales_together"> ‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô</label></td>
    <td><label><input type="checkbox" id="sales_separate"> ‡πÅ‡∏¢‡∏Å‡∏Å‡∏±‡∏ô‡πÑ‡∏õ</label></td>
  </tr>
</table>

<table>
  <tr>
    <td>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ä‡∏∏‡∏î‡∏ù‡∏∂‡∏Å‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏ã‡πà‡∏≠‡∏° ‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡πÉ‡∏ô‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô :</td>
  </tr>
  <tr>
    <td><input type="text" id="repair_detail"></td>
  </tr>
</table>

<table>
  <tr>
    <td>‡∏ä‡∏∏‡∏î‡∏ù‡∏∂‡∏Å‡∏¢‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà:</td>
    <td>
      <label><input type="checkbox" id="warranty_yes"> ‡πÉ‡∏ä‡πà ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 
        <input type="text" id="warranty_until">
      </label>
    </td>
    <td><label><input type="checkbox" id="warranty_no"> ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà</label></td>
  </tr>
</table>

<table>
  <tr>
    <th>‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ß‡∏≤‡∏á‡∏ä‡∏∏‡∏î‡∏ù‡∏∂‡∏Å‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏ï‡∏∂‡∏Å</th>
    <td><input type="text" id="building"></td>
    <th>‡∏ä‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà</th>
    <td><input type="text" id="floor"></td>
  </tr>
</table>

<button onclick="saveFile()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
<div id="statusMsg" class="status"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAXayBBLVSohNCIsnlWRq6rD0BUbW70MGk",
    authDomain: "events-666d6.firebaseapp.com",
    projectId: "events-666d6",
    storageBucket: "events-666d6.firebasestorage.app",
    messagingSenderId: "589078390914",
    appId: "1:589078390914:web:480ce96137ffac835aac9b",
    measurementId: "G-97GD75S814"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

// ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
window.saveFile = async function() {
  const jobNumber = document.getElementById("jobNumberInput").value.trim();
  if (!jobNumber) { alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å"); return; }

  const data = {
    jobNumber,
    date1: startDateInput.value, time1: time1.value,
    date2: date2.value, time2: time2.value,
    date4: endDateInput.value, time4: time4.value,

    car_company: car_company.checked,
    car_sales: car_sales.checked,
    bus: bus.checked,
    plane: plane.checked,

    sales_no: sales_no.checked,
    sales_yes: sales_yes.checked,
    sales_together: sales_together.checked,
    sales_separate: sales_separate.checked,

    repair_detail: repair_detail.value,
    warranty_yes: warranty_yes.checked,
    warranty_no: warranty_no.checked,
    warranty_until: warranty_until.value,

    building: building.value,
    floor: floor.value,

    timestamp: new Date().toISOString()
  };

  try {
    await setDoc(doc(db, "report3", jobNumber), data);
    statusMsg.textContent = "‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!";
    statusMsg.style.color = "green";
      setTimeout(() => { window.location.href = "notchoose.html"; }, 1000);
  } catch (err) {
    statusMsg.textContent = "‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err.message;
    statusMsg.style.color = "red";
  }
};

// ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Firestore
window.loadData = async function() {
  const jobNumber = document.getElementById("jobNumberInput").value.trim();
  if (!jobNumber) { alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤"); return; }

  const docRef = doc(db, "report3", jobNumber);
  const docSnap = await getDoc(docRef);

  if (docSnap.exists()) {
    const d = docSnap.data();
    startDateInput.value = d.date1 || "";
    time1.value = d.time1 || "";
    date2.value = d.date2 || "";
    time2.value = d.time2 || "";
    endDateInput.value = d.date4 || "";
    time4.value = d.time4 || "";

    car_company.checked = d.car_company || false;
    car_sales.checked = d.car_sales || false;
    bus.checked = d.bus || false;
    plane.checked = d.plane || false;

    sales_no.checked = d.sales_no || false;
    sales_yes.checked = d.sales_yes || false;
    sales_together.checked = d.sales_together || false;
    sales_separate.checked = d.sales_separate || false;

    repair_detail.value = d.repair_detail || "";
    warranty_yes.checked = d.warranty_yes || false;
    warranty_no.checked = d.warranty_no || false;
    warranty_until.value = d.warranty_until || "";
    building.value = d.building || "";
    floor.value = d.floor || "";

    statusMsg.textContent = "üìã ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!";
    statusMsg.style.color = "blue";
  } else {
    statusMsg.textContent = "‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
    statusMsg.style.color = "orange";
  }
};

// ‚úÖ ‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏à‡∏≤‡∏Å query string (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
const params = new URLSearchParams(window.location.search);
const job = params.get("job") || "";
const start = params.get("start") || "";
const end = params.get("end") || "";

document.getElementById("jobNumberInput").value = job;
document.getElementById("startDateInput").value = start;
document.getElementById("endDateInput").value = end;

// ‚úÖ ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ job ‡πÉ‡∏ô URL ‚Üí ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
if (job) {
  loadData();
}
</script>
</body>
</html>
