<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö</title>
<style>
body {
  font-family: "TH SarabunPSK", sans-serif;
  font-size: 14px;
  margin: 40px;
  color: #000;
}
h3 {
  text-align: center;
  margin-bottom: 0;
}
p.right {
  text-align: right;
  margin-top: 5px;
}
table {
  border-collapse: collapse;
  width: 100%;
  margin-bottom: 15px;
}
th, td {
  border: 1px solid #000;
  padding: 5px 6px;
  vertical-align: top;
}
th {
  text-align: center;
  background: #f5f5f5;
}
input[type="text"], input[type="date"], textarea {
  width: 100%;
  border: none;
  border-bottom: 1px dotted #000;
  font-size: 14px;
  font-family: "TH SarabunPSK", sans-serif;
  outline: none;
  background: transparent;
}
textarea {
  resize: none;
  height: 60px;
}
input[type="checkbox"] {
  transform: scale(1.2);
  margin-right: 4px;
}
button, .btnH {
  display: block;
  margin: 20px auto;
  font-size: 14px;
  padding: 6px 12px;
  background: #c00;
  color: #fff;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}
button:hover, .btnH:hover {
  background: #900;
}
.status {
  text-align: center;
  font-weight: bold;
  margin-top: 10px;
  color: green;
}

</style>
<div>
  <a href="notchoose.html" class="btnH">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô</a>
</div>
</head>
<body>
<p class="right">
  ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÅ‡∏ô‡∏ö‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô<br>
  ‡∏ù‡πà‡∏≤‡∏¢‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏•‡∏∞‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°
</p>

<h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö</h3><br><br>

<!-- ‚úÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô -->
<div style="margin-bottom:15px;">
  <label>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏á‡∏≤‡∏ô (Job Number): </label>
  <input type="text" id="jobNumberInput" readonly>
</div>

<table>
  <tr>
    <th>‡πÅ‡∏ú‡∏ô‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
    <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
    <th>‡πÄ‡∏ß‡∏•‡∏≤</th>
  </tr>
  <tr>
    <td>‡∏≠‡∏≠‡∏Å‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏à‡∏≤‡∏Å Office</td>
    <td><input type="text" id="startDateInput" readonly></td>
    <td><input type="text" id="time1"></td>
  </tr>
  <tr>
    <td>‡πÄ‡∏Ç‡πâ‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∏‡∏î‡∏ù‡∏∂‡∏Å</td>
    <td><input type="text" id="date2"></td>
    <td><input type="text" id="time2"></td>
  </tr>
  <tr>
    <td>‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö‡∏ä‡∏∏‡∏î‡∏ù‡∏∂‡∏Å</td>
    <td><input type="text" id="date3"></td>
    <td><input type="text" id="time3"></td>
  </tr>
  <tr>
    <td>‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏•‡∏±‡∏ö Office</td>
    <td><input type="text" id="endDateInput" readonly></td>
    <td><input type="text" id="time4"></td>
  </tr>
</table>

<table>
  <tr>
    <td>‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</td>
    <td><label><input type="checkbox" id="car_company"> ‡∏£‡∏ñ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</label></td>
    <td><label><input type="checkbox" id="car_sales"> ‡∏£‡∏ñ Sales</label></td>
    <td><label><input type="checkbox" id="bus"> ‡∏£‡∏ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ó‡∏≤‡∏á</label></td>
    <td><label><input type="checkbox" id="plane"> ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ö‡∏¥‡∏ô</label></td>
  </tr>
  <tr>
    <td>Sales ‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà:</td>
    <td><label><input type="checkbox" id="sales_no"> ‡πÑ‡∏°‡πà‡πÑ‡∏õ</label></td>
    <td><label><input type="checkbox" id="sales_yes"> ‡πÑ‡∏õ</label></td>
    <td><label><input type="checkbox" id="sales_together"> ‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô</label></td>
    <td><label><input type="checkbox" id="sales_separate"> ‡πÅ‡∏¢‡∏Å‡∏Å‡∏±‡∏ô‡πÑ‡∏õ</label></td>
  </tr>
</table>

<table>
  <tr>
    <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà</th>
    <th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ä‡∏∏‡∏î‡∏ù‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö</th>
    <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
  </tr>
  <tr><td>1</td><td><textarea id="item1" placeholder="***‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÅ‡∏ô‡∏ö***"></textarea></td><td><input type="text" id="qty1"></td></tr>
  <tr><td>2</td><td><textarea id="item2"></textarea></td><td><input type="text" id="qty2"></td></tr>
  <tr><td>3</td><td><textarea id="item3"></textarea></td><td><input type="text" id="qty3"></td></tr>
  <tr><td>4</td><td><textarea id="item4"></textarea></td><td><input type="text" id="qty4"></td></tr>
  <tr><td>5</td><td><textarea id="item5"></textarea></td><td><input type="text" id="qty5"></td></tr>
</table>

<table>
  <tr><th colspan="3">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏Ç‡∏ô‡∏¢‡πâ‡∏≤‡∏¢</th></tr>
  <tr>
    <td><label><input type="checkbox" id="move_all_top"> ‡∏à‡πâ‡∏≤‡∏á‡∏¢‡πâ‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</label></td>
    <td><label><input type="checkbox" id="move_all_bottom"> ‡∏Ç‡∏ô‡∏¢‡πâ‡∏≤‡∏¢‡πÄ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</label></td>
    <td><label><input type="checkbox" id="move_partial"> ‡∏à‡πâ‡∏≤‡∏á‡∏Ç‡∏ô‡∏¢‡πâ‡∏≤‡∏¢‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô ‡πÅ‡∏•‡∏∞ ‡∏Ç‡∏ô‡πÑ‡∏õ‡πÄ‡∏≠‡∏á‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏ô‡πÑ‡∏õ‡πÄ‡∏≠‡∏á‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ</label></td>
  </tr>
</table>

<table>
  <tr><th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th></tr>
  <tr><td><textarea id="carry1"></textarea></td><td><input type="text" id="carryQty1"></td></tr>
  <tr><td><textarea id="carry2"></textarea></td><td><input type="text" id="carryQty2"></td></tr>
  <tr><td><textarea id="carry3"></textarea></td><td><input type="text" id="carryQty3"></td></tr>
</table>

<table>
  <tr><th>‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∏‡∏î‡∏ù‡∏∂‡∏Å‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏∂‡∏Å‡πÑ‡∏´‡∏ô (‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà)...</th></tr>
  <tr><td><textarea id="roomInfo"></textarea></td></tr>
  <tr><th>‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÉ‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏≠‡∏µ‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà...</th></tr>
  <tr><td><textarea id="extraEquip"></textarea></td></tr>
</table>

<button onclick="saveFile()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
<div id="statusMsg" class="status"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAXayBBLVSohNCIsnlWRq6rD0BUbW70MGk",
    authDomain: "events-666d6.firebaseapp.com",
    projectId: "events-666d6",
    storageBucket: "events-666d6.firebasestorage.app",
    messagingSenderId: "589078390914",
    appId: "1:589078390914:web:480ce96137ffac835aac9b",
    measurementId: "G-97GD75S814"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // ‚úÖ ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å URL
  const params = new URLSearchParams(window.location.search);
  const job = params.get("job") || "";
  const start = params.get("start") || "";
  const end = params.get("end") || "";

  // ‚úÖ ‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á input
  document.getElementById("jobNumberInput").value = job;
  document.getElementById("startDateInput").value = start;
  document.getElementById("endDateInput").value = end;

  // ‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡∏à‡∏≤‡∏Å Firestore
  async function loadExistingData() {
    if (!job) return;
    const docRef = doc(db, "report_send", job);
    const docSnap = await getDoc(docRef);

    if (docSnap.exists()) {
      const data = docSnap.data();

      // ‚úÖ ‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡∏Å‡∏•‡∏±‡∏ö‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á input
      document.getElementById("time1").value = data.time1 || "";
      document.getElementById("date2").value = data.date2 || "";
      document.getElementById("time2").value = data.time2 || "";
      document.getElementById("date3").value = data.date3 || "";
      document.getElementById("time3").value = data.time3 || "";
      document.getElementById("time4").value = data.time4 || "";

      document.getElementById("car_company").checked = data.car_company || false;
      document.getElementById("car_sales").checked = data.car_sales || false;
      document.getElementById("bus").checked = data.bus || false;
      document.getElementById("plane").checked = data.plane || false;

      document.getElementById("sales_no").checked = data.sales_no || false;
      document.getElementById("sales_yes").checked = data.sales_yes || false;
      document.getElementById("sales_together").checked = data.sales_together || false;
      document.getElementById("sales_separate").checked = data.sales_separate || false;

      // ‚úÖ ‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
      if (data.items && Array.isArray(data.items)) {
        data.items.forEach((item, i) => {
          const index = i + 1;
          document.getElementById(`item${index}`).value = item.name || "";
          document.getElementById(`qty${index}`).value = item.qty || "";
        });
      }

      // ‚úÖ ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏Ç‡∏ô‡∏¢‡πâ‡∏≤‡∏¢
      document.getElementById("move_all_top").checked = data.move_all_top || false;
      document.getElementById("move_all_bottom").checked = data.move_all_bottom || false;
      document.getElementById("move_partial").checked = data.move_partial || false;

      // ‚úÖ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏ô‡∏¢‡πâ‡∏≤‡∏¢‡πÄ‡∏≠‡∏á
      if (data.carry && Array.isArray(data.carry)) {
        data.carry.forEach((c, i) => {
          const index = i + 1;
          document.getElementById(`carry${index}`).value = c.item || "";
          document.getElementById(`carryQty${index}`).value = c.qty || "";
        });
      }

      document.getElementById("roomInfo").value = data.roomInfo || "";
      document.getElementById("extraEquip").value = data.extraEquip || "";
    }
  }

  // üî• ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤
  loadExistingData();

  // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  window.saveFile = async function() {
    const jobNumber = document.getElementById("jobNumberInput").value.trim();
    if (!jobNumber) {
      alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å");
      return;
    }

    const data = {
      jobNumber,
      startDate: document.getElementById("startDateInput").value,
      endDate: document.getElementById("endDateInput").value,
      time1: document.getElementById("time1").value,
      date2: document.getElementById("date2").value,
      time2: document.getElementById("time2").value,
      date3: document.getElementById("date3").value,
      time3: document.getElementById("time3").value,
      time4: document.getElementById("time4").value,
      car_company: document.getElementById("car_company").checked,
      car_sales: document.getElementById("car_sales").checked,
      bus: document.getElementById("bus").checked,
      plane: document.getElementById("plane").checked,
      sales_no: document.getElementById("sales_no").checked,
      sales_yes: document.getElementById("sales_yes").checked,
      sales_together: document.getElementById("sales_together").checked,
      sales_separate: document.getElementById("sales_separate").checked,
      items: [
        { name: document.getElementById("item1").value, qty: document.getElementById("qty1").value },
        { name: document.getElementById("item2").value, qty: document.getElementById("qty2").value },
        { name: document.getElementById("item3").value, qty: document.getElementById("qty3").value },
        { name: document.getElementById("item4").value, qty: document.getElementById("qty4").value },
        { name: document.getElementById("item5").value, qty: document.getElementById("qty5").value }
      ],
      move_all_top: document.getElementById("move_all_top").checked,
      move_all_bottom: document.getElementById("move_all_bottom").checked,
      move_partial: document.getElementById("move_partial").checked,
      carry: [
        { item: document.getElementById("carry1").value, qty: document.getElementById("carryQty1").value },
        { item: document.getElementById("carry2").value, qty: document.getElementById("carryQty2").value },
        { item: document.getElementById("carry3").value, qty: document.getElementById("carryQty3").value }
      ],
      roomInfo: document.getElementById("roomInfo").value,
      extraEquip: document.getElementById("extraEquip").value,
      timestamp: new Date().toISOString()
    };

    try {
      await setDoc(doc(db, "report_send", jobNumber), data);
      document.getElementById("statusMsg").textContent = "‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!";
      setTimeout(() => { window.location.href = "notchoose.html"; }, 1000);
    } catch (err) {
      document.getElementById("statusMsg").textContent = "‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err.message;
      document.getElementById("statusMsg").style.color = "red";
    }
  };
</script>


</body>
</html>