<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏á‡∏≤‡∏ô | AUTODIDACTIC</title>
<link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Prompt', sans-serif;
  background: linear-gradient(to bottom, #fff, #fee);
  color: #c00;
  margin: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
}

/* ===== Header ===== */
header {
  width: 100%;
  background: #c00;
  color: #fff;
  padding: 12px 20px;
  text-align: center;
  font-weight: bold;
  box-shadow: 0 3px 8px rgba(0,0,0,0.15);
}
header a {
  position: absolute;
  left: 20px;
  top: 12px;
  background: rgba(255,255,255,0.2);
  color: #fff;
  padding: 6px 12px;
  border-radius: 8px;
  text-decoration: none;
}
header a:hover { background: rgba(255,255,255,0.35); }

form {
  width: 100%;
  max-width: 520px;
  background: #fff;
  border: 2px solid #c00;
  padding: 25px;
  margin: 30px 0;
  border-radius: 12px;
  box-shadow: 0 6px 15px rgba(0,0,0,0.08);
}
h2 { text-align: center; margin-top: 0; color: #c00; }

.input-line {
  width: 100%;
  padding: 10px;
  margin: 10px 0;
  border: 2px solid #c00;
  border-radius: 8px;
  outline: none;
  font-size: 15px;
  color: #c00;
  box-sizing: border-box;
  background: #fff;
}
textarea.input-line { height: 90px; resize: none; }

select.input-line {
  background: #fff;
}

button {
  width: 100%;
  padding: 12px;
  margin-top: 15px;
  border-radius: 8px;
  background: #c00;
  color: #fff;
  font-weight: bold;
  border: none;
  cursor: pointer;
  font-size: 16px;
  transition: 0.3s;
}
button:hover { background: #a00; transform: scale(1.02); }

a.btn-back {
  display: inline-block;
  text-align: center;
  background: #888;
  color: #fff;
  padding: 10px 18px;
  border-radius: 8px;
  text-decoration: none;
  font-weight: 600;
  margin-top: 8px;
}
a.btn-back:hover { background: #555; }

/* ===== Dropdown ===== */
.dropdown { position: relative; width: 100%; margin-bottom: 12px; }
.dropdown-btn {
  width: 100%;
  padding: 8px 10px;
  border: 2px solid #c00;
  border-radius: 8px;
  background: #fff;
  color: #c00;
  font-size: 15px;
  text-align: left;
  cursor: pointer;
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  min-height: 36px;
  align-items: center;
}
.dropdown-content {
  display: none;
  position: absolute;
  background-color: #fff;
  border: 1px solid #c00;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  z-index: 10;
  width: 100%;
  max-height: 200px;
  overflow-y: auto;
  padding: 5px;
}
.dropdown-content label {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 6px 10px;
  cursor: pointer;
}
.dropdown-content label:hover { background: #fee; }
.selected-name {
  background: #c00;
  color: #fff;
  border-radius: 12px;
  padding: 2px 6px;
  display: inline-flex;
  align-items: center;
  gap: 4px;
  font-size: 13px;
}

/* ===== Status badges ===== */
.status-badge {
  font-size: 11px;
  padding: 2px 6px;
  border-radius: 4px;
  margin-left: 8px;
  font-weight: bold;
}
.badge-busy { background: #ff5252; color: #fff; }
.badge-leave { background: #ffa726; color: #fff; }

footer {
  background: #c00;
  color: #fff;
  text-align: center;
  padding: 10px;
  font-size: 13px;
  margin-top: auto;
  width: 100%;
}
</style>
</head>

<body>

<header>
  <a href="manager.html">‚¨Ö ‡∏Å‡∏•‡∏±‡∏ö</a>
  ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏á‡∏≤‡∏ô | AUTODIDACTIC
</header>

<form id="editForm">
  <input type="hidden" id="eventId">

  <label>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏á‡∏≤‡∏ô:</label>
  <input type="text" id="job" class="input-line" readonly>

  <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏á‡∏≤‡∏ô:</label>
  <input type="text" id="jobNumber" class="input-line" readonly>

  <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°:</label>
  <input type="date" id="start" class="input-line" required>

  <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î:</label>
  <input type="date" id="end" class="input-line" required>

  <label>‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô:</label>
  <div class="dropdown">
    <button type="button" class="dropdown-btn" id="titleBtn">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠</button>
    <div class="dropdown-content" id="titleList"></div>
  </div>

  <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà:</label>
  <input type="text" id="location" class="input-line" required readonly>

  <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô:</label>
  <textarea id="details" class="input-line" required></textarea>

  <label>‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô:</label>
  <div class="dropdown">
    <button type="button" class="dropdown-btn" id="assignedByBtn">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠</button>
    <div class="dropdown-content" id="assignedByList"></div>
  </div>

  <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</label>
  <select id="status" class="input-line">
    <option value="‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥">‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</option>
    <option value="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
    <option value="‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß">‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</option>
  </select>

  <button type="submit">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
  <a href="manager.html" class="btn-back">‡∏Å‡∏•‡∏±‡∏ö</a>
</form>

<footer>¬© 2025 AUTODIDACTIC SYSTEM</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
import { getFirestore, doc, getDoc, updateDoc, getDocs, collection } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAXayBBLVSohNCIsnlWRq6rD0BUbW70MGk",
  authDomain: "events-666d6.firebaseapp.com",
  projectId: "events-666d6",
  storageBucket: "events-666d6.firebasestorage.app",
  messagingSenderId: "589078390914",
  appId: "1:589078390914:web:480ce96137ffac835aac9b",
  measurementId: "G-97GD75S814"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const params = new URLSearchParams(window.location.search);
const eventId = params.get("id");

const titleList = document.getElementById("titleList");
const assignedByList = document.getElementById("assignedByList");
const titleBtn = document.getElementById("titleBtn");
const assignedByBtn = document.getElementById("assignedByBtn");

let originalEventData = null; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏ß‡πâ

// ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á (‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô + ‡∏ß‡∏±‡∏ô‡∏•‡∏≤)
async function loadAvailableWorkers(startDate, endDate) {
  const usedNames = new Set();
  const leaveNames = new Set();

  if (!startDate || !endDate) return { usedNames, leaveNames };

  // ‡∏î‡∏∂‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡πÉ‡∏Ñ‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà
  const eventsSnap = await getDocs(collection(db, "events"));
  eventsSnap.forEach(docSnap => {
    // ‡∏Ç‡πâ‡∏≤‡∏°‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏¢‡∏π‡πà
    if (docSnap.id === eventId) return;

    const data = docSnap.data();
    if (!data.start || !data.end) return;

    const existingStart = new Date(data.start);
    const existingEnd = new Date(data.end);
    const newStart = new Date(startDate);
    const newEnd = new Date(endDate);

    // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    const isOverlap = newStart <= existingEnd && newEnd >= existingStart;
    if (isOverlap) {
      (data.workers || []).forEach(n => usedNames.add(n));
    }
  });

  // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡∏±‡∏ô‡∏•‡∏≤‡∏´‡∏¢‡∏∏‡∏î
  const leavesSnap = await getDocs(collection(db, "leaves"));
  leavesSnap.forEach(docSnap => {
    const data = docSnap.data();
    if (data.start <= endDate && data.end >= startDate) {
      leaveNames.add(data.name);
    }
  });

  return { usedNames, leaveNames };
}

// ‚úÖ ‡πÇ‡∏´‡∏•‡∏î Dropdown ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ß‡πà‡∏≤‡∏á/‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á
async function loadDropdowns() {
  const startDate = document.getElementById("start").value;
  const endDate = document.getElementById("end").value;

  // ‚úÖ ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÅ‡∏ö‡∏ö‡∏õ‡∏Å‡∏ï‡∏¥
  if (!startDate || !endDate) {
    titleList.innerHTML = "";
    assignedByList.innerHTML = "";

    const workersSnap = await getDocs(collection(db, "workers"));
    workersSnap.forEach(d => {
      const name = d.data().name;
      titleList.innerHTML += `
        <label>
          <input type="checkbox" value="${name}"> ${name}
        </label>`;
    });

    const assignersSnap = await getDocs(collection(db, "assigners"));
    assignersSnap.forEach(d => {
      const name = d.data().name;
      assignedByList.innerHTML += `<label><input type="checkbox" value="${name}"> ${name}</label>`;
    });
    return;
  }

  // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á
  const { usedNames, leaveNames } = await loadAvailableWorkers(startDate, endDate);

  titleList.innerHTML = "";
  assignedByList.innerHTML = "";

  // ‡πÇ‡∏´‡∏•‡∏î‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô
  const workersSnap = await getDocs(collection(db, "workers"));
  workersSnap.forEach(d => {
    const name = d.data().name;
    const isBusy = usedNames.has(name);
    const isOnLeave = leaveNames.has(name);
    const isUnavailable = isBusy || isOnLeave;

    // ‡∏ñ‡πâ‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡πÄ‡∏Ñ‡∏¢‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ô‡∏á‡∏≤‡∏ô‡πÄ‡∏î‡∏¥‡∏° ‡πÉ‡∏´‡πâ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å
    const wasOriginallySelected = originalEventData?.workers?.includes(name);
    const shouldDisable = isUnavailable && !wasOriginallySelected;

    let badge = "";
    if (isBusy && !wasOriginallySelected) badge = `<span class="status-badge badge-busy">‚õî ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô</span>`;
    else if (isOnLeave && !wasOriginallySelected) badge = `<span class="status-badge badge-leave">üèñ ‡∏•‡∏≤‡∏á‡∏≤‡∏ô</span>`;

    titleList.innerHTML += `
      <label style="opacity:${shouldDisable ? 0.5 : 1}">
        <input type="checkbox" value="${name}" ${shouldDisable ? "disabled" : ""}> 
        ${name} ${badge}
      </label>`;
  });

  // ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô
  const assignersSnap = await getDocs(collection(db, "assigners"));
  assignersSnap.forEach(d => {
    const name = d.data().name;
    assignedByList.innerHTML += `<label><input type="checkbox" value="${name}"> ${name}</label>`;
  });
}

// ‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô‡πÄ‡∏î‡∏¥‡∏°
async function loadEventData() {
  if (!eventId) return alert("‡πÑ‡∏°‡πà‡∏û‡∏ö ID ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô URL");

  const ref = doc(db, "events", eventId);
  const snap = await getDoc(ref);

  if (!snap.exists()) return alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ");

  const data = snap.data();
  originalEventData = data; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏ß‡πâ

  document.getElementById("eventId").value = eventId;
  document.getElementById("jobNumber").value = data.jobNumber || "";
  document.getElementById("job").value = data.job || "";
  document.getElementById("location").value = data.location || "";
  document.getElementById("details").value = data.details || "";
  document.getElementById("start").value = data.start || "";
  document.getElementById("end").value = data.end || "";
  document.getElementById("status").value = data.status || "‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥";

  // ‚úÖ ‡πÇ‡∏´‡∏•‡∏î dropdown ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î)
  await loadDropdowns();

  // ‚úÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ß‡πâ ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÇ‡∏´‡∏•‡∏î dropdown ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß
  setTimeout(() => {
    titleList.querySelectorAll("input[type=checkbox]").forEach(cb => {
      if (data.workers?.includes(cb.value)) cb.checked = true;
    });

    assignedByList.querySelectorAll("input[type=checkbox]").forEach(cb => {
      if (data.assigners?.includes(cb.value)) cb.checked = true;
    });

    updateDropdownButton(titleList, titleBtn);
    updateDropdownButton(assignedByList, assignedByBtn);
  }, 100);
}

// ‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
document.getElementById("editForm").addEventListener("submit", async e => {
  e.preventDefault();

  const jobNumber = document.getElementById("jobNumber").value.trim();
  const job = document.getElementById("job").value.trim();
  const location = document.getElementById("location").value.trim();
  const details = document.getElementById("details").value.trim();
  const start = document.getElementById("start").value;
  const end = document.getElementById("end").value;
  const status = document.getElementById("status").value;

  const workers = Array.from(
    titleList.querySelectorAll("input[type=checkbox]:checked")
  ).map(cb => cb.value);

  const assigners = Array.from(
    assignedByList.querySelectorAll("input[type=checkbox]:checked")
  ).map(cb => cb.value);

  await updateDoc(doc(db, "events", eventId), {
    jobNumber, job, location, details, start, end, status, workers, assigners
  });

  alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
  window.location.href = "manager.html";
});

// ‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏õ‡∏∏‡πà‡∏° Dropdown
function updateDropdownButton(list, btn) {
  const selected = Array.from(list.querySelectorAll("input:checked"))
    .map(cb => cb.value);

  btn.innerHTML = selected.length
    ? selected.map(n => `<span class='selected-name'>${n}</span>`).join(" ")
    : "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠";
}

// ‚úÖ Toggle Dropdown
titleBtn.addEventListener("click", (e) => {
  e.stopPropagation();
  titleList.style.display = titleList.style.display === "block" ? "none" : "block";
  assignedByList.style.display = "none";
});

assignedByBtn.addEventListener("click", (e) => {
  e.stopPropagation();
  assignedByList.style.display = assignedByList.style.display === "block" ? "none" : "block";
  titleList.style.display = "none";
});

// ‚úÖ ‡∏õ‡∏¥‡∏î Dropdown ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡πâ‡∏≤‡∏á‡∏ô‡∏≠‡∏Å
document.addEventListener("click", (e) => {
  if (!e.target.closest(".dropdown")) {
    titleList.style.display = "none";
    assignedByList.style.display = "none";
  }
});

titleList.addEventListener("change", () => {
  updateDropdownButton(titleList, titleBtn);
});

assignedByList.addEventListener("change", () => {
  updateDropdownButton(assignedByList, assignedByBtn);
});

// ‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
document.getElementById("start").addEventListener("change", async () => {
  await loadDropdowns();
  
  // ‚úÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÇ‡∏´‡∏•‡∏î dropdown
  setTimeout(() => {
    if (originalEventData?.workers) {
      titleList.querySelectorAll("input[type=checkbox]").forEach(cb => {
        if (originalEventData.workers.includes(cb.value)) cb.checked = true;
      });
      updateDropdownButton(titleList, titleBtn);
    }
  }, 100);
});

document.getElementById("end").addEventListener("change", async () => {
  await loadDropdowns();
  
  // ‚úÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÇ‡∏´‡∏•‡∏î dropdown
  setTimeout(() => {
    if (originalEventData?.workers) {
      titleList.querySelectorAll("input[type=checkbox]").forEach(cb => {
        if (originalEventData.workers.includes(cb.value)) cb.checked = true;
      });
      updateDropdownButton(titleList, titleBtn);
    }
  }, 100);
});

loadEventData();
</script>

</body>
</html>